generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  HOD
  ADVISOR
  STAFF
  STUDENT
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  OD
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now())

  attendances Attendance[]
  odRequests  ODRequest[]
  marks Marks[]
  complaints Complaint[]
}


model Subject {
  id   Int    @id @default(autoincrement())
  name String
  attendances Attendance[]
  marks Marks[]
}

model Attendance {
  id        Int              @id @default(autoincrement())
  date      DateTime
  status    AttendanceStatus
  studentId Int
  subjectId Int

  student User    @relation(fields: [studentId], references: [id])
  subject Subject @relation(fields: [subjectId], references: [id])
  @@unique([studentId, subjectId, date])

}
enum ODStatus {
  PENDING
  APPROVED
  REJECTED
}

model ODRequest {
  id        Int      @id @default(autoincrement())
  studentId Int
  fromDate  DateTime
  toDate    DateTime
  reason    String
  status    ODStatus @default(PENDING)
  createdAt DateTime @default(now())

  student User @relation(fields: [studentId], references: [id])
}

model Marks {
  id        Int @id @default(autoincrement())
  studentId Int
  subjectId Int

  cat1      Int @default(0)
  cat2      Int @default(0)
  attendanceScore Int @default(0)
  internalTotal   Int @default(0)

  student User    @relation(fields: [studentId], references: [id])
  subject Subject @relation(fields: [subjectId], references: [id])

  @@unique([studentId, subjectId])
}
enum ComplaintStatus {
  OPEN
  IN_REVIEW
  RESOLVED
}

model Complaint {
  id          Int @id @default(autoincrement())
  category    String
  description String
  status      ComplaintStatus @default(OPEN)
  createdAt   DateTime @default(now())

  // Stored but not exposed (optional)
  studentId   Int?
  student     User? @relation(fields: [studentId], references: [id])
}
